"use strict";exports.id=925,exports.ids=[925],exports.modules={6925:(e,t,s)=>{s.r(t),s.d(t,{default:()=>AdminDashboard});var a=s(784),r=s(9885),l=s(7114),n=s(599),i=s(5495),d=s(5555),c=s(644),o=s(7),x=s(5441),m=s(5894),u=s(7004),h=s(8212),p=s(5256),g=s(5987);function useWebSocket(e,t={}){let{enabled:s=!0,reconnectInterval:a=5e3,reconnectAttempts:l=5,onOpen:n,onClose:i,onError:d,onMessage:c}=t,[o,x]=(0,r.useState)("closed"),[m,u]=(0,r.useState)(null),[h,p]=(0,r.useState)(0),g=(0,r.useRef)(null),j=(0,r.useRef)(null),f=(0,r.useRef)(0),b=(0,r.useCallback)(()=>{if(s)try{x("connecting"),g.current=new WebSocket(e),g.current.onopen=()=>{x("open"),f.current=0,n?.()},g.current.onclose=()=>{x("closed"),i?.(),s&&f.current<l&&(j.current=setTimeout(()=>{f.current+=1,p(f.current),b()},a))},g.current.onerror=e=>{x("error"),d?.(e)},g.current.onmessage=e=>{u(e),c?.(e)}}catch(e){x("error")}},[e,s,a,l,n,i,d,c]),y=(0,r.useCallback)(()=>{j.current&&(clearTimeout(j.current),j.current=null),g.current&&(g.current.close(),g.current=null),x("closed")},[]),v=(0,r.useCallback)(e=>{g.current&&"open"===o&&g.current.send(JSON.stringify(e))},[o]);return(0,r.useEffect)(()=>(s?b():y(),()=>{y()}),[s,b,y]),(0,r.useEffect)(()=>{s&&"connecting"!==o&&(y(),b())},[e]),{sendMessage:v,lastMessage:m,connectionStatus:o,reconnectAttempts:h}}function useAuth(){let e=(0,l.useRouter)(),[t,s]=(0,r.useState)({user:null,token:null,isLoading:!0,isAuthenticated:!1});(0,r.useEffect)(()=>{a()},[]);let a=(0,r.useCallback)(async()=>{try{let e=localStorage.getItem("adminToken"),t=localStorage.getItem("adminUser");if(e&&t){let a=JSON.parse(t),r=await fetch("/api/admin/auth/verify",{headers:{Authorization:`Bearer ${e}`}});r.ok?s({user:a,token:e,isLoading:!1,isAuthenticated:!0}):(localStorage.removeItem("adminToken"),localStorage.removeItem("adminUser"),s({user:null,token:null,isLoading:!1,isAuthenticated:!1}))}else s(e=>({...e,isLoading:!1}))}catch(e){s(e=>({...e,isLoading:!1}))}},[]),n=(0,r.useCallback)(async e=>{try{let t=await fetch("/api/admin/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){let e=await t.json();return localStorage.setItem("adminToken",e.token),localStorage.setItem("adminUser",JSON.stringify(e.user)),s({user:e.user,token:e.token,isLoading:!1,isAuthenticated:!0}),!0}{let e=await t.json();throw Error(e.message||"Login failed")}}catch(e){return!1}},[]),i=(0,r.useCallback)(()=>{localStorage.removeItem("adminToken"),localStorage.removeItem("adminUser"),s({user:null,token:null,isLoading:!1,isAuthenticated:!1}),e.push("/admin/login")},[e]),d=(0,r.useCallback)(e=>{localStorage.setItem("adminUser",JSON.stringify(e)),s(t=>({...t,user:e}))},[]),c=(0,r.useCallback)(async()=>{try{let e=localStorage.getItem("adminToken");if(!e)return!1;let t=await fetch("/api/admin/auth/refresh",{method:"POST",headers:{Authorization:`Bearer ${e}`}});if(!t.ok)return i(),!1;{let e=await t.json();return localStorage.setItem("adminToken",e.token),s(t=>({...t,token:e.token})),!0}}catch(e){return i(),!1}},[i]);return{...t,login:n,logout:i,updateUser:d,refreshToken:c}}var j=s(8699);function AdminDashboard(){let e=(0,l.useRouter)(),{user:t,isLoading:s}=useAuth(),[f,b]=(0,r.useState)(null),[y,v]=(0,r.useState)([]),[N,k]=(0,r.useState)(!0),[S,C]=(0,r.useState)(""),[w,D]=(0,r.useState)("all"),[A,O]=(0,r.useState)("today"),[T,z]=(0,r.useState)(!0),[P,I]=(0,r.useState)(30),{lastMessage:E,connectionStatus:L}=useWebSocket("ws://localhost:3001/admin/orders",{enabled:T,reconnectInterval:5e3,reconnectAttempts:5});(0,r.useEffect)(()=>{s||t&&"admin"===t.role||e.push("/admin/login")},[t,s,e]),(0,r.useEffect)(()=>{fetchDashboardData()},[]),(0,r.useEffect)(()=>{if(E){let e=JSON.parse(E.data);handleWebSocketMessage(e)}},[E]),(0,r.useEffect)(()=>{if(T){let e=setInterval(()=>{fetchDashboardData()},1e3*P);return()=>clearInterval(e)}},[T,P]);let fetchDashboardData=async()=>{try{let e=await fetch("/api/admin/dashboard",{headers:{Authorization:`Bearer ${localStorage.getItem("adminToken")}`}});if(e.ok){let t=await e.json();b(t.stats),v(t.orders)}}catch(e){}finally{k(!1)}},handleWebSocketMessage=e=>{switch(e.type){case"new_order":v(t=>[e.order,...t]),b(t=>t?{...t,totalOrders:t.totalOrders+1,activeOrders:t.activeOrders+1,recentOrders:[e.order,...t.recentOrders.slice(0,9)]}:null);break;case"order_status_update":v(t=>t.map(t=>t.id===e.orderId?{...t,status:e.status,estimatedTime:e.estimatedTime}:t));break;case"payment_update":v(t=>t.map(t=>t.id===e.orderId?{...t,paymentStatus:e.paymentStatus}:t))}},updateOrderStatus=async(e,t)=>{try{let s=await fetch(`/api/admin/orders/${e}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("adminToken")}`},body:JSON.stringify({status:t})});s.ok&&v(s=>s.map(s=>s.id===e?{...s,status:t}:s))}catch(e){}},exportData=e=>{let t=y.map(e=>({id:e.id,customer:e.customerName,total:e.total,status:e.status,paymentStatus:e.paymentStatus,paymentMethod:e.paymentMethod,createdAt:e.createdAt}));if("csv"===e){let e=[["ID","Cliente","Total","Status","Pagamento","M\xe9todo","Data"],...t.map(e=>Object.values(e))].map(e=>e.join(",")).join("\n"),s=new Blob([e],{type:"text/csv"}),a=URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`orders-${new Date().toISOString().split("T")[0]}.csv`,r.click()}else{let e=JSON.stringify(t,null,2),s=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`orders-${new Date().toISOString().split("T")[0]}.json`,r.click()}},R=y.filter(e=>{let t=e.customerName.toLowerCase().includes(S.toLowerCase())||e.id.toLowerCase().includes(S.toLowerCase()),s="all"===w||e.status===w;return t&&s}),getStatusColor=e=>({pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-blue-100 text-blue-800",preparing:"bg-purple-100 text-purple-800",ready:"bg-green-100 text-green-800",delivered:"bg-gray-100 text-gray-800",cancelled:"bg-red-100 text-red-800"})[e],getPaymentStatusColor=e=>({pending:"bg-orange-100 text-orange-800",paid:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800"})[e];return s||N?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-coxinha-orange"})}):t&&"admin"===t.role?(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-coxinha-light to-orange-50",children:[a.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b sticky top-0 z-10",children:a.jsx("div",{className:"container mx-auto px-4 py-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-coxinha-dark",children:"Dashboard Admin - Vai Coxinha"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[a.jsx("div",{className:`w-2 h-2 rounded-full ${"open"===L?"bg-green-500":"connecting"===L?"bg-yellow-500":"bg-red-500"}`}),a.jsx("span",{className:"text-sm text-gray-600",children:"open"===L?"Conectado":"connecting"===L?"Conectando...":"Desconectado"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("label",{className:"text-sm text-gray-600",children:"Auto Atualizar"}),(0,a.jsxs)(d.z,{variant:"outline",size:"sm",onClick:()=>z(!T),className:T?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:[a.jsx(c.Z,{className:`w-4 h-4 mr-2 ${T?"animate-spin":""}`}),T?"Auto Atualizar: ON":"Auto Atualizar: OFF"]}),(0,a.jsxs)(d.z,{variant:"outline",size:"sm",onClick:fetchDashboardData,disabled:N,children:[a.jsx(c.Z,{className:"w-4 h-4 mr-2"}),"Atualizar"]})]}),a.jsx(d.z,{size:"sm",onClick:()=>e.push("/admin/orders"),children:"\uD83D\uDCCB Ver Todos Pedidos"}),a.jsx(d.z,{size:"sm",onClick:()=>e.push("/admin/products"),children:"\uD83D\uDECD️ Gerenciar Produtos"})]})]})})}),(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[a.jsx("div",{className:"mb-8",children:a.jsx(i.W,{className:"p-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Per\xedodo"}),(0,a.jsxs)("select",{value:A,onChange:e=>O(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-coxinha-primary",children:[a.jsx("option",{value:"today",children:"Hoje"}),a.jsx("option",{value:"week",children:"Esta Semana"}),a.jsx("option",{value:"month",children:"Este M\xeas"}),a.jsx("option",{value:"year",children:"Este Ano"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,a.jsxs)("select",{value:w,onChange:e=>D(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-coxinha-primary",children:[a.jsx("option",{value:"all",children:"Todos"}),a.jsx("option",{value:"pending",children:"Pendente"}),a.jsx("option",{value:"confirmed",children:"Confirmado"}),a.jsx("option",{value:"preparing",children:"Preparando"}),a.jsx("option",{value:"ready",children:"Pronto"}),a.jsx("option",{value:"delivered",children:"Entregue"}),a.jsx("option",{value:"cancelled",children:"Cancelado"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar"}),a.jsx("input",{type:"text",placeholder:"Cliente ou ID do pedido",value:S,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-coxinha-primary"})]}),(0,a.jsxs)("div",{className:"flex items-end space-x-2",children:[a.jsx(d.z,{onClick:()=>exportData("csv"),className:"flex-1",children:"\uD83D\uDCCA Exportar CSV"}),a.jsx(d.z,{onClick:()=>exportData("json"),className:"flex-1",children:"\uD83D\uDCC4 Exportar JSON"})]})]})})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[a.jsx("div",{children:(0,a.jsxs)(n.Zb,{className:"p-6 text-center hover:scale-105 transition-transform",children:[a.jsx("div",{className:"text-3xl font-bold text-coxinha-primary mb-2",children:f?.totalOrders||0}),a.jsx("div",{className:"text-gray-600",children:"Total de Pedidos"}),(0,a.jsxs)("div",{className:"text-sm text-green-600 mt-1",children:[a.jsx(o.Z,{className:"inline w-4 h-4 mr-1"}),"+12% vs ontem"]})]})}),a.jsx("div",{children:(0,a.jsxs)(n.Zb,{className:"p-6 text-center hover:scale-105 transition-transform",children:[(0,a.jsxs)("div",{className:"text-3xl font-bold text-green-600 mb-2",children:["R$ ",f?.totalRevenue||0]}),a.jsx("div",{className:"text-gray-600",children:"Faturamento Total"}),(0,a.jsxs)("div",{className:"text-sm text-green-600 mt-1",children:[a.jsx(o.Z,{className:"inline w-4 h-4 mr-1"}),"+8% vs ontem"]})]})}),a.jsx("div",{children:(0,a.jsxs)(n.Zb,{className:"p-6 text-center hover:scale-105 transition-transform",children:[a.jsx("div",{className:"text-3xl font-bold text-orange-600 mb-2",children:f?.activeOrders||0}),a.jsx("div",{className:"text-gray-600",children:"Pedidos Ativos"}),(0,a.jsxs)("div",{className:"text-sm text-orange-600 mt-1",children:[a.jsx(x.Z,{className:"inline w-4 h-4 mr-1"}),"Em prepara\xe7\xe3o"]})]})}),a.jsx("div",{children:(0,a.jsxs)(n.Zb,{className:"p-6 text-center hover:scale-105 transition-transform",children:[(0,a.jsxs)("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:["R$ ",f?.averageOrderValue||0]}),a.jsx("div",{className:"text-gray-600",children:"Ticket M\xe9dio"}),(0,a.jsxs)("div",{className:"text-sm text-purple-600 mt-1",children:[a.jsx(m.Z,{className:"inline w-4 h-4 mr-1"}),"Por pedido"]})]})})]}),a.jsx("div",{children:(0,a.jsxs)(i.W,{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h2",{className:"text-xl font-bold text-coxinha-dark",children:"Pedidos Recentes"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[R.length," pedido(s) encontrado(s)"]})]}),a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-200",children:[a.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Pedido"}),a.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Cliente"}),a.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Total"}),a.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Status"}),a.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Pagamento"}),a.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Tempo"}),a.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"A\xe7\xf5es"})]})}),a.jsx("tbody",{children:R.slice(0,10).map(t=>(0,a.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[a.jsx("td",{className:"py-3 px-4",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-semibold text-gray-900",children:["#",t.id.slice(-6)]}),a.jsx("div",{className:"text-sm text-gray-500",children:(0,j.o)(t.createdAt)})]})}),a.jsx("td",{className:"py-3 px-4",children:(0,a.jsxs)("div",{children:[a.jsx("div",{className:"font-semibold text-gray-900",children:t.customerName}),a.jsx("div",{className:"text-sm text-gray-500",children:t.customerPhone})]})}),(0,a.jsxs)("td",{className:"py-3 px-4",children:[a.jsx("div",{className:"font-semibold text-gray-900",children:(0,j.x)(t.total)}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[t.items.length," item(s)"]})]}),a.jsx("td",{className:"py-3 px-4",children:(0,a.jsxs)("select",{value:t.status,onChange:e=>updateOrderStatus(t.id,e.target.value),className:`px-2 py-1 rounded-full text-xs font-medium border-0 ${getStatusColor(t.status)}`,children:[a.jsx("option",{value:"pending",children:"Pendente"}),a.jsx("option",{value:"confirmed",children:"Confirmado"}),a.jsx("option",{value:"preparing",children:"Preparando"}),a.jsx("option",{value:"ready",children:"Pronto"}),a.jsx("option",{value:"delivered",children:"Entregue"}),a.jsx("option",{value:"cancelled",children:"Cancelado"})]})}),a.jsx("td",{className:"py-3 px-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${getPaymentStatusColor(t.paymentStatus)}`,children:"paid"===t.paymentStatus?"Pago":"pending"===t.paymentStatus?"Pendente":"Falhou"}),a.jsx("span",{className:"text-xs text-gray-500",children:"pix"===t.paymentMethod?"PIX":"card"===t.paymentMethod?"Cart\xe3o":"Dinheiro"})]})}),a.jsx("td",{className:"py-3 px-4",children:(0,a.jsxs)("div",{className:"text-sm text-gray-900",children:[t.estimatedTime," min"]})}),a.jsx("td",{className:"py-3 px-4",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[a.jsx(d.z,{size:"sm",onClick:()=>e.push(`/admin/orders/${t.id}`),children:"\uD83D\uDC41️ Ver"}),a.jsx(d.z,{size:"sm",variant:"destructive",onClick:()=>updateOrderStatus(t.id,"cancelled"),disabled:"delivered"===t.status||"cancelled"===t.status,children:"❌ Cancelar"})]})})]},t.id))})]})}),0===R.length&&a.jsx("div",{className:"text-center py-8 text-gray-500",children:"Nenhum pedido encontrado com os filtros aplicados."})]})}),a.jsx("div",{className:"mt-8",children:(0,a.jsxs)(i.W,{className:"p-6",children:[a.jsx("h2",{className:"text-lg font-bold text-coxinha-dark mb-4",children:"A\xe7\xf5es R\xe1pidas"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)(d.z,{onClick:()=>e.push("/admin/products"),className:"flex flex-col items-center space-y-2 p-4",children:[a.jsx(u.Z,{className:"w-8 h-8 text-coxinha-primary"}),a.jsx("span",{children:"Gerenciar Produtos"})]}),(0,a.jsxs)(d.z,{onClick:()=>e.push("/admin/categories"),className:"flex flex-col items-center space-y-2 p-4",children:[a.jsx(h.Z,{className:"w-8 h-8 text-green-600"}),a.jsx("span",{children:"Categorias"})]}),(0,a.jsxs)(d.z,{onClick:()=>e.push("/admin/analytics"),className:"flex flex-col items-center space-y-2 p-4",children:[a.jsx(p.Z,{className:"w-8 h-8 text-purple-600"}),a.jsx("span",{children:"An\xe1lises"})]}),(0,a.jsxs)(d.z,{onClick:()=>e.push("/admin/settings"),className:"flex flex-col items-center space-y-2 p-4",children:[a.jsx(g.Z,{className:"w-8 h-8 text-orange-600"}),a.jsx("span",{children:"Configura\xe7\xf5es"})]})]})]})})]})]}):null}},5495:(e,t,s)=>{s.d(t,{W:()=>GlassCard});var a=s(784);s(9885);var r=s(8699);let GlassCard=({children:e,className:t,variant:s="default"})=>a.jsx("div",{className:(0,r.cn)("rounded-2xl p-6 transition-all duration-300",{default:"bg-white/10 backdrop-blur-sm border border-white/20",elevated:"bg-white/20 backdrop-blur-md border border-white/30 shadow-xl",flat:"bg-white/5 backdrop-blur-sm border border-white/10"}[s],t),children:e})}};